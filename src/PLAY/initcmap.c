

#include "jimk.h"
#include "closest_.h"
#include "peekpok_.h"

/* initcmap.c - File contains the default color map 
   and a function to find out what colors to draw the
    menus in.  Call find_colors() before you draw a menu if the palette
	has changed. */

unsigned char  sys_cmap[COLORS*3] = {
	0, 0, 0,	 0, 0, 32,	 0, 0, 63,	 32, 0, 32,
	63, 0, 32,	 63, 0, 0,	 63, 32, 0,	 32, 32, 0,
	32, 63, 0, 	 0, 63, 0,	 0, 32, 32,	 0, 32, 63,
	63, 63, 63,	 42, 42, 42,	 21, 21, 21,	 

/* 17 color grey scale */
	0, 0, 0,
	4, 4, 4,	 8, 8, 8, 	 12, 12, 12, 	 16, 16, 16,
	20, 20, 20,	24,24,24,	28,28,28,	32,32,32,
	36,36,36,	40,40,40,	44,44,44,	48,48,48,
	52,52,52,	56,56,56,	60,60,60,	63,63,63,

/* true-color fake cmap 6x6x6 rgb cube  216 colors */
	3,3,3,	 3,3,15,	 3,3,27,	 3,3,39,	
	3,3,51,	 3,3,63,	 3,15,3,	 3,15,15,	
	3,15,27,	 3,15,39,	 3,15,51,	 3,15,63,	
	3,27,3,	 3,27,15,	 3,27,27,	 3,27,39,	
	3,27,51,	 3,27,63,	 3,39,3,	 3,39,15,	
	3,39,27,	 3,39,39,	 3,39,51,	 3,39,63,	
	3,51,3,	 3,51,15,	 3,51,27,	 3,51,39,	
	3,51,51,	 3,51,63,	 3,63,3,	 3,63,15,	
	3,63,27,	 3,63,39,	 3,63,51,	 3,63,63,	
	15,3,3,	 15,3,15,	 15,3,27,	 15,3,39,	
	15,3,51,	 15,3,63,	 15,15,3,	 15,15,15,	
	15,15,27,	 15,15,39,	 15,15,51,	 15,15,63,	
	15,27,3,	 15,27,15,	 15,27,27,	 15,27,39,	
	15,27,51,	 15,27,63,	 15,39,3,	 15,39,15,	
	15,39,27,	 15,39,39,	 15,39,51,	 15,39,63,	
	15,51,3,	 15,51,15,	 15,51,27,	 15,51,39,	
	15,51,51,	 15,51,63,	 15,63,3,	 15,63,15,	
	15,63,27,	 15,63,39,	 15,63,51,	 15,63,63,	
	27,3,3,	 27,3,15,	 27,3,27,	 27,3,39,	
	27,3,51,	 27,3,63,	 27,15,3,	 27,15,15,	
	27,15,27,	 27,15,39,	 27,15,51,	 27,15,63,	
	27,27,3,	 27,27,15,	 27,27,27,	 27,27,39,	
	27,27,51,	 27,27,63,	 27,39,3,	 27,39,15,	
	27,39,27,	 27,39,39,	 27,39,51,	 27,39,63,	
	27,51,3,	 27,51,15,	 27,51,27,	 27,51,39,	
	27,51,51,	 27,51,63,	 27,63,3,	 27,63,15,	
	27,63,27,	 27,63,39,	 27,63,51,	 27,63,63,	
	39,3,3,	 39,3,15,	 39,3,27,	 39,3,39,	
	39,3,51,	 39,3,63,	 39,15,3,	 39,15,15,	
	39,15,27,	 39,15,39,	 39,15,51,	 39,15,63,	
	39,27,3,	 39,27,15,	 39,27,27,	 39,27,39,	
	39,27,51,	 39,27,63,	 39,39,3,	 39,39,15,	
	39,39,27,	 39,39,39,	 39,39,51,	 39,39,63,	
	39,51,3,	 39,51,15,	 39,51,27,	 39,51,39,	
	39,51,51,	 39,51,63,	 39,63,3,	 39,63,15,	
	39,63,27,	 39,63,39,	 39,63,51,	 39,63,63,	
	51,3,3,	 51,3,15,	 51,3,27,	 51,3,39,	
	51,3,51,	 51,3,63,	 51,15,3,	 51,15,15,	
	51,15,27,	 51,15,39,	 51,15,51,	 51,15,63,	
	51,27,3,	 51,27,15,	 51,27,27,	 51,27,39,	
	51,27,51,	 51,27,63,	 51,39,3,	 51,39,15,	
	51,39,27,	 51,39,39,	 51,39,51,	 51,39,63,	
	51,51,3,	 51,51,15,	 51,51,27,	 51,51,39,	
	51,51,51,	 51,51,63,	 51,63,3,	 51,63,15,	
	51,63,27,	 51,63,39,	 51,63,51,	 51,63,63,	
	63,3,3,	 63,3,15,	 63,3,27,	 63,3,39,	
	63,3,51,	 63,3,63,	 63,15,3,	 63,15,15,	
	63,15,27,	 63,15,39,	 63,15,51,	 63,15,63,	
	63,27,3,	 63,27,15,	 63,27,27,	 63,27,39,	
	63,27,51,	 63,27,63,	 63,39,3,	 63,39,15,	
	63,39,27,	 63,39,39,	 63,39,51,	 63,39,63,	
	63,51,3,	 63,51,15,	 63,51,27,	 63,51,39,	
	63,51,51,	 63,51,63,	 63,63,3,	 63,63,15,	
	63,63,27,	 63,63,39,	 63,63,51,	 63,63,63,	

/* system color space of 8 */
	0, 0, 32,   32, 0, 0,   0, 32, 0,   32, 0, 63,
	32, 32, 32, 0, 0, 0,	63,63,63,	63,0,0,
};

unsigned char sys_space_colors[] = 
{
	0, 0, 32,   32, 0, 0,   0, 32, 0,   32, 0, 63,
	32, 32, 32,  0, 0, 0,	63,63,63,   63,0,0,
};

unsigned char  sys_start_colors[] = {
	0, 0, 0,	 0, 0, 32,	 0, 0, 63,	 32, 0, 32,
	63, 0, 32,	 63, 0, 0,	 63, 32, 0,	 32, 32, 0,
	32, 63, 0, 	 0, 63, 0,	 0, 32, 32,	 0, 32, 63,
	63, 63, 63,	 42, 42, 42,	 21, 21, 21,	 
};

unsigned char pure_white[3] = {63,63,63};
unsigned char pure_black[3] = {0,0,0};
unsigned char pure_red[] = {63, 0, 0};
unsigned char pure_green[] = {0, 63, 0};
unsigned char pure_blue[] = {0, 0, 63};
static unsigned char pure_grey[] = {24, 24, 24};
static unsigned char pure_bright[3] = {58, 58, 58};
static unsigned char bright_grey[] = {42, 42, 42};

UBYTE mcideals[6][3] =
	{
	{0, 0, 0},	/* menu black */
	{24, 24, 24}, /* menu grey */
	{42, 42, 42}, /* menu light */
	{58, 58, 58}, /* menu bright */
	{63, 0, 0},  /* menu red */
	{0, 0, 63},  /* menu extra */
	};

int mc_colors[6];	/* colors that are closest to ideals */

/* min difference color threshold */
#define SEE_T (6*6)

/* 1st system grabbable color */
#define SYS_C (251)


/* find closest colors in existing color map to ideal menu colors */
f_colors()
{
int i;

for (i=0; i<5; i++)
	mc_colors[i] = closestc(mcideals[i], vf.cmap,COLORS);
}

find_colors()
{
f_colors();
check_cmap();
}

int sys5;

/* making sure menu colors are visible after we find the closest fit
   between 'ideal' menu colors and what's actually in color map. If
   not visible force ideal menu colors into last 5 colors. */
check_cmap()
{
int i, j, t;
UBYTE *a, *b;
UBYTE mycolors[6][3];

for (i=0; i<5; i++)
	{
	copy_bytes(vf.cmap + 3*mc_colors[i], mycolors[i], 3);
	}
sys5 = 0;
for (i=0; i<5; i++)
	{
	a = mycolors[i];
	for (j=0; j<5; j++)
		{
		if (i != j)
			{
			b = mycolors[j];
			if (color_dif(a,b) < SEE_T)
				{
				sys5 = 1;
				goto BREAKOUT;
				}
			}
		}
	}
BREAKOUT:
if (sys5)
	{
	jset_colors(SYS_C, 5, mcideals);
	for (i=0; i<5; i++)
		mc_colors[i] = i + SYS_C;
	}
}

uncheck_cmap()
{
if (sys5)
	jset_colors(COLORS-5, 5, vf.cmap+3*(COLORS-5));
}
